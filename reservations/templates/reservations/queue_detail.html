{% extends 'website/base.html' %}
{% load static %}
{% block head %}
    <script src="{% static 'reservations/js/queue_calendar.js' %}"></script>
    {{ jquery | safe }}
    {{ fullcalendar | safe }}

    <style>
        .fc h2 {
            font-size: 2.28rem;
            line-height: 110%;
        }

        .fc-time-grid .fc-slats td {
            height: 2.5em;
            border-bottom: 0;
        }
        .fc-day.fc-past {
            background-color:#eee;
        }
        .fc-now-indicator {
            position:absolute;
            border: 0 solid #F6BE00;
        }
    </style>
{% endblock %}

{% block content %}
<div class="section hs-green">
	<div class="container">
		<div class="row white-text">
			<div class="col s12">
				<h4>{{ object.name }}</h4>
				<p>På denne siden kan du reservere bruk av {{ object.name }}.</p>
			</div>
		</div>
	</div>
</div>
<div class="section">
	<div class="container">
		{% if not perms.reservations.view_user_details and disable_reservations %}
		<div class="row">
			<div class="col s12">
				<p>Hackerspace er i en tidsramme hvor reservasjonssystemet er stengt. Dette er som regel eksamenstid, ferie, etc.</p>
				<p>Dersom du er medlem i Hackerspace, logg på din konto for å kunne reservere print utenom vanlige åpningstider.</p>
			</div>
		</div>
		{% else %}
		<div class="row">
			<div class="col s12 m6">
				<div class="card-panel small hs-green white-text z-depth-0">
					<p>Grønne blokker er dine egne reservasjoner.</p>
					<p>Trykk på en av dine reservasjoner for å oppdatere kommentaren eller slette den.</p>
				</div>
			</div>
			<div class="col s12 m6">
				<div class="card-panel small hs-gray white-text z-depth-0">
					<p>Grå blokker er andre sine reservasjoner.</p>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col s12">
				<div id='calendar'></div>
			</div>
		</div>
		{% endif %}
	</div>
</div>

{% include 'reservations/reservation_modal.html' %}
<script>
    $(() => {
        const userHasPhoneNumber = {{ request.user.profile.phone_number|yesno:"true,false" }}
        const userPhoneNumber = userHasPhoneNumber ? "{{ request.user.profile.phone_number }}" : null
        queueCalendar(
            csrfToken='{{ csrf_token }}',
            serverTime="{% now "c" %}",
            userPk={{ request.user.id }},
            queuePk='{{ object.id }}',
            userIsAuthenticated={{ request.user.is_authenticated|yesno:"true,false" }},
            userIsSuperuser={{ request.user.is_superuser|yesno:"true,false" }},
            userIsMember={{ perms.reservations.view_user_details|yesno:"true,false" }},
            userCanViewUserDetails={{ perms.reservations.view_user_details|yesno:"true,false" }},
            userFullName="{{ request.user.get_full_name }}",
            userPhoneNumber,
        )
    });
</script>
{% endblock content %}
